{% extends 'admin/a_dashbd.html' %}
{% load static %}

{% block content %}
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" style="color:darkgreen">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Add User Button -->
<button id="addUserBtn" class="btn btn-add">+ Add User</button>

<!-- User Modal -->
<div id="userModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeUserModal">&times;</span>
    <h3>{% if edit_user %}Edit User{% else %}Add New User{% endif %}</h3>
    <form id="userForm" method="POST" action="{% url 'requests:user_list' %}">
      {% csrf_token %}
      <input type="hidden" name="mode" value="{% if edit_user %}edit{% else %}add{% endif %}">
      <div class="form-scroll">
        <div class="form-row">
          <div class="form-group">
            <label>User ID*</label>
            <input type="text" name="userid" value="{{ edit_user.userid }}" {% if edit_user %}readonly{% endif %} required>
          </div>
          <div class="form-group">
            <label>Name*</label>
            <input type="text" name="name" value="{{ edit_user.name }}" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Department*</label>
            <input type="text" name="department" value="{{ edit_user.department }}" required>
          </div>
          <div class="form-group">
            <label>School</label>
            <input type="text" name="school" value="{{ edit_user.school|default:'' }}">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Section</label>
            <input type="text" name="section" value="{{ edit_user.section|default:'' }}">
          </div>
          <div class="form-group">
            <label>Cell</label>
            <input type="text" name="cell" value="{{ edit_user.cell|default:'' }}">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Center</label>
            <input type="text" name="center" value="{{ edit_user.center|default:'' }}">
          </div>
          <div class="form-group">
            <label>Laboratory</label>
            <input type="text" name="laboratory" value="{{ edit_user.laboratory|default:'' }}">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Club</label>
            <input type="text" name="club" value="{{ edit_user.club|default:'' }}">
          </div>
          <div class="form-group">
            <label>Office</label>
            <input type="text" name="office" value="{{ edit_user.office|default:'' }}">
          </div>
        </div>
      </div>
      <div class="form-footer">
        <button type="submit" class="btn btn-edit">Save User</button>
      </div>
    </form>
  </div>
</div>

<!-- User List -->
<h2>User List</h2>

{% if not users %}
<div class="no-users">No users found.</div>
{% else %}
<div class="user-table">
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>User ID</th>
                <th>Name</th>
                <th>Department</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ user.userid }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.department|default:"-" }}</td>
                <td>
                    <a href="?edit={{ user.userid }}" class="btn btn-edit">Edit</a>
                    <a href="?delete={{ user.userid }}" class="btn btn-delete" onclick="return confirm('Are you sure?')">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<style>
    /* Modal Styles - EXACTLY as in your reference */
    .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.4);
        overflow: auto;
    }
    .modal-content {
        background-color: white;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        width: 600px;
        max-height: 90vh;
        position: relative;
        display: flex;
        flex-direction: column;
        padding-bottom: 30px;
    }
    .close {
        position: absolute;
        right: 25px;
        top: 15px;
        cursor: pointer;
        font-size: 24px;
        color: #555;
    }
    .form-scroll {
        overflow-y: auto;
        flex-grow: 1;
        padding-right: 10px;
        margin-bottom: 0;
    }
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    .form-group {
        flex: 1;
        margin-bottom: 0;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
    }
    .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .form-footer {
        margin-top: 20px;
        padding: 20px 0 0;
        border-top: 1px solid #eee;
        text-align: right;
    }
    .user-table table {
        width: 100%;
        border-collapse: collapse;
    }
    .user-table th, .user-table td {
        padding: 10px;
        border: 1px solid #ccc;
        text-align: left;
    }
    .btn-edit {
        background-color: #4CAF50;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
    }
    .btn-delete {
        background-color: #f44336;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
    }
    .no-users {
        padding: 15px;
        color: #555;
        font-style: italic;
    }

    .form-scroll::-webkit-scrollbar {
        width: 8px;
    }
    .form-scroll::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    .form-scroll::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }
    .form-scroll::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const addUserBtn = document.getElementById("addUserBtn");
        const modal = document.getElementById("userModal");
        const closeBtn = document.getElementById("closeUserModal");
        
        // Open modal when Add User button is clicked
        if (addUserBtn) {
            addUserBtn.addEventListener("click", () => {
                modal.style.display = "block";
                // Reset form if not in edit mode
                {% if not edit_user %}
                document.getElementById('userForm').reset();
                {% endif %}
            });
        }
        
        // Close modal when X is clicked
        if (closeBtn) {
            closeBtn.addEventListener("click", () => {
                modal.style.display = "none";
                // Redirect to clear edit mode
                {% if edit_user %}
                window.location.href = "{% url 'requests:user_list' %}";
                {% endif %}
            });
        }
        
        // Close modal when clicking outside
        window.addEventListener("click", e => {
            if (e.target == modal) {
                modal.style.display = "none";
                // Redirect to clear edit mode
                {% if edit_user %}
                window.location.href = "{% url 'requests:user_list' %}";
                {% endif %}
            }
        });
        
        // Auto-open modal if in edit mode
        {% if edit_user %}
        modal.style.display = "block";
        {% endif %}
    });
</script>
{% endblock %}
{% comment %} {% extends 'admin/a_dashbd.html' %}
{% load static %}

{% block content %}

<button id="addUserBtn" class="btn btn-add">+ Add User</button>

<!-- User Modal -->
<div id="userModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeUserModal">&times;</span>
    <h3>Add New User</h3>
    <form id="userForm" method="POST">
      {% csrf_token %}
      <div class="form-scroll">
        <div class="form-row">
          <div class="form-group">
            <label>User ID*</label>
            <input type="text" name="userid" required>
          </div>
          <div class="form-group">
            <label>Name*</label>
            <input type="text" name="name" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Department*</label>
            <input type="text" name="department" required>
          </div>
          <div class="form-group">
            <label>School</label>
            <input type="text" name="school">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Section</label>
            <input type="text" name="section">
          </div>
          <div class="form-group">
            <label>Cell</label>
            <input type="text" name="cell">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Center</label>
            <input type="text" name="center">
          </div>
          <div class="form-group">
            <label>Laboratory</label>
            <input type="text" name="laboratory">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Club</label>
            <input type="text" name="club">
          </div>
          <div class="form-group">
            <label>Office</label>
            <input type="text" name="office">
          </div>
        </div>
      </div>
      <div class="form-footer">
        <button type="submit" class="btn btn-edit">Save User</button>
      </div>
    </form>
  </div>
</div>

<!-- Rest of your content -->
<h2>User List</h2>

{% if not users %}
<div class="no-users">No users found.</div>
{% else %}
<div class="user-table">
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>User ID</th>
                <th>Name</th>
                <th>Department</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ user.userid }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.department|default:"-" }}</td>
                <td>
                    <button class="btn btn-edit" onclick="editUser('{{ user.userid }}')">Edit</button>
                    <button class="btn btn-delete" onclick="deleteUser('{{ user.userid }}')">Delete</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 10;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.4);
        overflow: auto;
    }
    .modal-content {
        background-color: white;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        width: 600px;
        max-height: 90vh;
        position: relative;
        display: flex;
        flex-direction: column;
        padding-bottom: 30px; /* Added padding at bottom */
    }
    .close {
        position: absolute;
        right: 25px;
        top: 15px;
        cursor: pointer;
        font-size: 24px;
        color: #555;
    }
    .form-scroll {
        overflow-y: auto;
        flex-grow: 1;
        padding-right: 10px;
        margin-bottom: 0; /* Removed margin-bottom */
    }
    .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    .form-group {
        flex: 1;
        margin-bottom: 0;
    }
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
    }
    .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .form-footer {
        margin-top: 20px;
        padding: 20px 0 0;
        border-top: 1px solid #eee;
        text-align: right; /* Align button to right */
    }
    .user-table table {
        width: 100%;
        border-collapse: collapse;
    }
    .user-table th, .user-table td {
        padding: 10px;
        border: 1px solid #ccc;
        text-align: left;
    }
    .btn-edit {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: auto; /* Changed from 100% to auto */
    }
    .btn-delete {
        background-color: #f44336;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .no-users {
        padding: 15px;
        color: #555;
        font-style: italic;
    }
    .btn-add {
        background-color: #2196F3;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 20px;
    }

    /* Custom scrollbar for form */
    .form-scroll::-webkit-scrollbar {
        width: 8px;
    }
    .form-scroll::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    .form-scroll::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }
    .form-scroll::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
</style>

<script>
    function editUser(userid) {
        alert("Edit user: " + userid);
    }

    function deleteUser(userid) {
        if (confirm("Are you sure you want to delete user " + userid + "?")) {
            alert("Deleted user: " + userid);
        }
    }
    document.addEventListener("DOMContentLoaded", function () {
        const addUserBtn = document.getElementById("addUserBtn");
        const modal = document.getElementById("userModal");
        const closeBtn = document.getElementById("closeUserModal");
        
        if (addUserBtn && modal && closeBtn) {
            addUserBtn.addEventListener("click", () => modal.style.display = "block");
            closeBtn.addEventListener("click", () => modal.style.display = "none");
            
            window.addEventListener("click", e => {
                if (e.target == modal) {
                    modal.style.display = "none";
                }
            });
        }
    });
</script>
{% endblock %} {% endcomment %}